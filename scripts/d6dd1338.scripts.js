"use strict";angular.module("dataManager",["underscore"]).factory("dataLoader",["$resource",function(a){return a("data/:data")}]).factory("dataStore",["_","$log",function(a){var b={},c=[],d=function(){return(new Date).getTime()};return{push:function(b,e){if(!a.isEmpty(e)){var f=d(),g=a.isEmpty(b)?f:b;c.push({name:g,data:e})}},getDataList:function(){return a.pluck(c,"name")},getContainer:function(){return c},getDataByName:function(b){return a.where(c,{name:b})[0]},getCurrentItem:function(){return b},setCurrentItem:function(a){b=a}}}]).factory("dataTransformer",["_","$log",function(a,b){return{getNumericColomns:function(b,c){var d=[];return a.each(b,function(b,e){for(var f=!0,g=0;g<c.length;g++)if(!a.isNumber(c[g][e])){f=!1;break}f&&d.push(b)}),d},LRTonvd3Scatter:function(b,c,d,e){var f=b.input.columns,g=[];a.each(b.input.values,function(b){g.push({x:b[f.indexOf(c)]+1e-8*Math.random(),y:b[f.indexOf(d)]+1e-8*Math.random(),size:a.isEmpty(e)?100:b[f.indexOf(e)]+1e-8*Math.random()})});var h=[];a.each(b.predicted.values,function(b){h.push({x:b[f.indexOf(c)]+1e-8*Math.random(),y:b[f.indexOf(d)]+1e-8*Math.random(),size:a.isEmpty(e)?100:b[f.indexOf(e)]+1e-8*Math.random()})});var i=[{key:"Predicted",color:"#FF2F00",values:h},{key:"Input",color:"00D0FF",values:g}];return i},DTToStockPredition:function(c,d,e){var f=c.input.columns,g=function(b,d){if("STOCK_CLOSE_PRICE"!==e)return"circle";var g=a.findWhere(c.input.values,{0:b}),h=a.findWhere(c.predicted.values,{0:b});if(g[f.indexOf("STOCK_TREND")]!==h[f.indexOf("STOCK_TREND")])return"diamond";var i;return i="UP"===d||1===d?"triangle-up":"DOWN"===d||0===d?"triangle-down":"square"},h=[],i=a.pluck(c.predicted.values,f.indexOf("ID"));a.each(c.input.values,function(b){var c=b[f.indexOf("ID")];a.contains(i,c)||h.push({x:"DATE"===d?d3.time.format("%m/%d/%Y").parse(b[f.indexOf(d)]):b[f.indexOf(d)]+1e-8*Math.random(),y:"DATE"===e?d3.time.format("%m/%d/%Y").parse(b[f.indexOf(e)]):b[f.indexOf(e)]+1e-8*Math.random(),shape:"circle",size:100})});var j=[];a.each(c.predicted.values,function(a){j.push({x:"DATE"===d?d3.time.format("%m/%d/%Y").parse(a[f.indexOf(d)]):a[f.indexOf(d)]+1e-8*Math.random(),y:"DATE"===e?d3.time.format("%m/%d/%Y").parse(a[f.indexOf(e)]):a[f.indexOf(e)]+1e-8*Math.random(),shape:g(a[f.indexOf("ID")],a[f.indexOf("STOCK_TREND")]),size:100})});var k=[{key:"Training set",color:"#00D0FF",values:h},{key:"Predicted",color:"#FF2F00",values:j}];return b.log(k),k},DTToStockGrid:function(b){var c=[],d=b.columns;return a.each(b.values,function(b){var e={};a.each(d,function(a,c){e[a]=b[c]}),c.push(e)}),c},LRToGrid:function(b){var c=[],d=b.input.columns;return a.each(b.input.values,function(b){var e={};a.each(d,function(a,c){e[a]=b[c]}),e.$group="input",c.push(e)}),a.each(list,function(){}),a.each(b.predicted.values,function(b){var e={};a.each(d,function(a,c){e[a]=b[c]}),e.$group="predicted",c.push(e)}),c}}}]),angular.module("controllers",["dataManager","underscore","ngDropdowns"]).controller("tabsCtrl",["$scope","$log",function(a){a.tabs=[{title:"Table View",imgUrl:"/images/icons/grid-26.png",contentUrl:"/views/tab-content-grid.html",active:!0},{title:"Scatter Plot",imgUrl:"/images/icons/scatter_plot-25.png",contentUrl:"/views/tab-content-scatter.html",active:!1},{title:"Trend Prediction-Decision Tree",imgUrl:"/images/icons/scatter_plot-25.png",contentUrl:"/views/tab-content-stock-dt.html",active:!1},{title:"Trend Prediction-Logistic Regression",imgUrl:"/images/icons/scatter_plot-25.png",contentUrl:"/views/tab-content-stock-rg.html",active:!1}]}]).controller("scatterCtrl",["$scope","$log","_","dataLoader","dataStore","dataTransformer","$q",function(a,b,c,d,e,f,g){a.showPlaceholder=!0,a.showError=!1,a.$watch(function(){return!a.showPlaceholder&&!a.showError},function(b){a.showContent=b});var h={};g.all([d.get({data:"input.json"}).$promise,d.get({data:"predicted_1d.json"}).$promise]).then(function(b){h.input=b[0],h.predicted=b[1],a.columns=f.getNumericColomns(h.input.columns,h.input.values),a.attrOptions=[],c.each(a.columns,function(b){a.attrOptions.push({attrName:b,value:b})}),a.attrOptions.push({attrName:"DATE",value:"DATE"}),a.attrForX={attrName:"DATE",value:"DATE"},a.attrForY={attrName:"STOCK_CLOSE_PRICE",value:"STOCK_CLOSE_PRICE"},a.axisChange(),a.showPlaceholder=!1},function(c){a.showPlaceholder=!1,a.showError=!0,b.log("data loading failed. reason: "+c)}),a.axisChange=function(){if(a.attrForX.value&&a.attrForY.value){var b=f.DTToStockPredition(h,a.attrForX.value,a.attrForY.value);b[0].key="Input data",c.each(b[1].values,function(a){a.shape="circle",b[0].values.push(a)}),b.splice(1,1),a.data=b}},a.getShape=function(){return function(a){return a.shape}},a.xAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForX.value?b:c;return d},a.yAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForY.value?b:c;return d}}]).controller("stockDTCtrl",["$scope","$log","_","dataLoader","dataStore","dataTransformer","$q",function(a,b,c,d,e,f,g){a.showPlaceholder=!0,a.showError=!1;var h={};g.all([d.get({data:"input.json"}).$promise,d.get({data:"PAL.V_DTP_STOCK_NEW_1D.json"}).$promise]).then(function(b){h.input=b[0],h.predicted=b[1],a.columns=f.getNumericColomns(h.input.columns,h.input.values),a.attrOptions=[],c.each(a.columns,function(b){a.attrOptions.push({attrName:b,value:b})}),a.attrOptions.push({attrName:"DATE",value:"DATE"}),a.attrForX={attrName:"DATE",value:"DATE"},a.attrForY={attrName:"STOCK_CLOSE_PRICE",value:"STOCK_CLOSE_PRICE"},a.axisChange(),a.showPlaceholder=!1},function(c){a.showPlaceholder=!1,a.showError=!0,b.log("data loading failed. reason: "+c)}),a.axisChange=function(){a.attrForX.value&&a.attrForY.value&&(a.data=f.DTToStockPredition(h,a.attrForX.value,a.attrForY.value))},a.getShape=function(){return function(a){return a.shape}},a.xAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForX.value?b:c;return d},a.yAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForY.value?b:c;return d}}]).controller("stockRGCtrl",["$scope","$log","_","dataLoader","dataStore","dataTransformer","$q",function(a,b,c,d,e,f,g){a.showPlaceholder=!0,a.showError=!1;var h={};g.all([d.get({data:"PAL.LGRG_STOCK_CAUSE.json"}).$promise,d.get({data:"PAL.V_LGRGP_STOCK_1D.json"}).$promise]).then(function(b){h.input=b[0],h.predicted=b[1],a.columns=f.getNumericColomns(h.input.columns,h.input.values),a.attrOptions=[],c.each(a.columns,function(b){a.attrOptions.push({attrName:b,value:b})}),a.attrOptions.push({attrName:"DATE",value:"DATE"}),a.attrForX={attrName:"DATE",value:"DATE"},a.attrForY={attrName:"STOCK_CLOSE_PRICE",value:"STOCK_CLOSE_PRICE"},a.axisChange(),a.showPlaceholder=!1},function(c){a.showPlaceholder=!1,a.showError=!0,b.log("data loading failed. reason: "+c)}),a.axisChange=function(){a.attrForX.value&&a.attrForY.value&&(a.data=f.DTToStockPredition(h,a.attrForX.value,a.attrForY.value))},a.getShape=function(){return function(a){return a.shape}},a.xAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForX.value?b:c;return d},a.yAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForY.value?b:c;return d}}]).controller("gridCtrl",["_","$scope","$log","dataLoader","dataStore","dataTransformer",function(a,b,c,d,e,f){b.showPlaceholder=!0,b.showError=!1,b.gridData=[],b.columnDefs=[],b.gridOptions={data:"gridData",enableColumnResize:!0,columnDefs:"columnDefs"};var g=[];d.get({data:"testdata.json"},function(c){b.columns=c.input.columns,a.each(b.columns,function(a){var b={field:a};g.push(b)}),g.push({field:"$group",displayName:"Group"}),b.columnDefs=g,b.gridData=f.LRToGrid(c),b.showPlaceholder=!1},function(a){b.showPlaceholder=!1,b.showError=!0,c.log("data loading failed. reason: "+a)})}]).controller("stockGridCtrl",["_","$scope","$log","dataLoader","dataStore","dataTransformer",function(a,b,c,d,e,f){b.showPlaceholder=!0,b.showError=!1,b.gridData=[],b.columnDefs=[],b.gridOptions={data:"gridData",enableColumnResize:!0,columnDefs:"columnDefs"};var g=[];d.get({data:"input.json"},function(c){b.columns=c.columns,a.each(b.columns,function(a){var b={field:a};g.push(b)}),b.columnDefs=g,b.gridData=f.DTToStockGrid(c),b.showPlaceholder=!1},function(a){b.showPlaceholder=!1,b.showError=!0,c.log("data loading failed. reason: "+a)})}]),angular.module("visDirectives",[]).directive("visScatter",function(){return{restrict:"EA",templateUrl:"/views/vis-scatter-template.html",scope:!0}}).directive("visStockDT",function(){return{restrict:"EA",templateUrl:"/views/vis-stock-dt-template.html",scope:!0}}).directive("visStockRG",function(){return{restrict:"EA",templateUrl:"/views/vis-stock-rg-template.html",scope:!0}}).directive("visGrid",function(){return{restrict:"EA",templateUrl:"/views/vis-grid-template.html",scope:!0}}).directive("shapeLegend",function(){return{restrict:"E",scope:{},template:'<div class="shape-legend-container"></div>',link:function(){var a=[{x:10,y:5,shape:"triangle-up",text:"Correct prediction: Price goes up"},{x:310,y:5,shape:"triangle-down",text:"Correct prediction: Price goes down"},{x:10,y:25,shape:"square",text:"Correct prediction: Price remains unchange"},{x:310,y:25,shape:"diamond",text:"Incorrect prediction"}],b=d3.select(".shape-legend-container").append("svg:svg").attr("width",1200).attr("height",80);b.selectAll("path").data(a).enter().append("path").style("fill","#FF2F00").style("stroke","#FF2F00").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("d",d3.svg.symbol().type(function(a){return a.shape})),b.selectAll("text").data(a).enter().append("text").attr("transform",function(a){return"translate("+(a.x+20)+","+(a.y+5)+")"}).text(function(a){return a.text})}}}),angular.module("webApp",["ngCookies","ngResource","ngSanitize","ngRoute","underscore","dataManager","controllers","visDirectives","nvd3ChartDirectives","ngDropdowns","ui.bootstrap","ngGrid"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"/views/tabs.html"}).otherwise({redirectTo:"/"})}]);