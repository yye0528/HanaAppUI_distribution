"use strict";angular.module("dataManager",["underscore"]).factory("dataLoader",["$resource",function(a){return a("data/:data")}]).factory("dataStore",["_","$log",function(a){var b={},c=[],d=function(){return(new Date).getTime()};return{push:function(b,e){if(!a.isEmpty(e)){var f=d(),g=a.isEmpty(b)?f:b;c.push({name:g,data:e})}},getDataList:function(){return a.pluck(c,"name")},getContainer:function(){return c},getDataByName:function(b){return a.where(c,{name:b})[0]},getCurrentItem:function(){return b},setCurrentItem:function(a){b=a}}}]).factory("dataTransformer",["_","$log",function(a){return{getNumericColomns:function(b,c){var d=[];return a.each(b,function(b,e){for(var f=!0,g=0;g<c.length;g++)if(!a.isNumber(c[g][e])){f=!1;break}f&&d.push(b)}),d},stockTonvd3Scatter:function(b,c,d){var e=b.input.columns,f=[];a.each(b.input.values,function(a){f.push({x:"DATE"===c?d3.time.format("%m/%d/%Y").parse(a[e.indexOf(c)]):a[e.indexOf(c)]+1e-8*Math.random(),y:"DATE"===d?d3.time.format("%m/%d/%Y").parse(a[e.indexOf(d)]):a[e.indexOf(d)]+1e-8*Math.random(),shape:"circle",size:100})});var g=[{key:"Input data",color:"#0099FF",values:f}];return g},DTToStockPredition:function(b){var c=b.input.columns,d=function(d){var e=a.findWhere(b.input.values,{0:d}),f=a.findWhere(b.predicted.values,{0:d});return e[c.indexOf("STOCK_TREND")]===f[c.indexOf("STOCK_TREND")]},e=function(a){var b;return b="UP"===a||1===a?"triangle-up":"DOWN"===a||0===a?"triangle-down":"square"},f=[],g=[],h=[],i=a.pluck(b.predicted.values,c.indexOf("ID"));a.each(b.input.values,function(b){var d=b[c.indexOf("ID")];if(!a.contains(i,d)){var g=b[c.indexOf("STOCK_TREND")];f.push({x:d3.time.format("%m/%d/%Y").parse(b[c.indexOf("DATE")]),y:b[c.indexOf("STOCK_CLOSE_PRICE")],shape:e(g),size:100})}}),a.each(b.predicted.values,function(a){var b=a[c.indexOf("ID")],f=a[c.indexOf("STOCK_TREND")];d(b)?g.push({x:d3.time.format("%m/%d/%Y").parse(a[c.indexOf("DATE")]),y:a[c.indexOf("STOCK_CLOSE_PRICE")],shape:e(f),size:100}):h.push({x:d3.time.format("%m/%d/%Y").parse(a[c.indexOf("DATE")]),y:a[c.indexOf("STOCK_CLOSE_PRICE")],shape:e(f),size:100})});var j=[{key:"Training set",color:"#0099FF",values:f},{key:"Corret Predictions",color:"#009900",values:g},{key:"incorrect Predicitons",color:"#FF0000",values:h}];return j},RGToStockPredition:function(b){var c=b.input.columns,d=function(d){var e=a.findWhere(b.input.values,{0:d}),f=a.findWhere(b.predicted.values,{0:d});return e[c.indexOf("STOCK_TREND")]===f[c.indexOf("STOCK_TREND")]},e=function(a){var b;return b="UP"===a||1===a?"triangle-up":"DOWN"===a||0===a?"triangle-down":"square"},f=[],g=[];a.each(b.predicted.values,function(a){var b=a[c.indexOf("ID")],h=a[c.indexOf("STOCK_TREND")];d(b)?f.push({x:d3.time.format("%m/%d/%Y").parse(a[c.indexOf("DATE")]),y:a[c.indexOf("STOCK_CLOSE_PRICE")],shape:e(h),size:100}):g.push({x:d3.time.format("%m/%d/%Y").parse(a[c.indexOf("DATE")]),y:a[c.indexOf("STOCK_CLOSE_PRICE")],shape:e(h),size:100})});var h=[{key:"Corret Predictions",color:"#009900",values:f},{key:"incorrect Predicitons",color:"#FF0000",values:g}];return h},DTToStockGrid:function(b){var c=[],d=b.columns;return a.each(b.values,function(b){var e={};a.each(d,function(a,c){e[a]=b[c]}),c.push(e)}),c},LRToGrid:function(b){var c=[],d=b.input.columns;return a.each(b.input.values,function(b){var e={};a.each(d,function(a,c){e[a]=b[c]}),e.$group="input",c.push(e)}),a.each(list,function(){}),a.each(b.predicted.values,function(b){var e={};a.each(d,function(a,c){e[a]=b[c]}),e.$group="predicted",c.push(e)}),c}}}]),angular.module("controllers",["dataManager","underscore","ngDropdowns"]).controller("tabsCtrl",["$scope","$log",function(a){a.tabs=[{title:"Input data",imgUrl:"/images/icons/grid-26.png",contentUrl:"/views/tab-content-grid.html",active:!0},{title:"Overview",imgUrl:"/images/icons/scatter_plot-25.png",contentUrl:"/views/tab-content-scatter.html",active:!1},{title:"Trend Prediction-Decision Tree",imgUrl:"/images/icons/scatter_plot-25.png",contentUrl:"/views/tab-content-stock-dt.html",active:!1},{title:"Trend Prediction-Logistic Regression",imgUrl:"/images/icons/scatter_plot-25.png",contentUrl:"/views/tab-content-stock-rg.html",active:!1}]}]).controller("scatterCtrl",["$scope","$log","_","dataLoader","dataStore","dataTransformer","$q",function(a,b,c,d,e,f,g){a.showPlaceholder=!0,a.showError=!1,a.$watch(function(){return!a.showPlaceholder&&!a.showError},function(b){a.showContent=b});var h={};g.all([d.get({data:"input.json"}).$promise,d.get({data:"predicted_1d.json"}).$promise]).then(function(b){h.input=b[0],h.predicted=b[1],a.columns=f.getNumericColomns(h.input.columns,h.input.values),a.attrOptions=[],c.each(a.columns,function(b){a.attrOptions.push({attrName:b,value:b})}),a.attrOptions.push({attrName:"DATE",value:"DATE"}),a.attrForX={attrName:"DATE",value:"DATE"},a.attrForY={attrName:"STOCK_CLOSE_PRICE",value:"STOCK_CLOSE_PRICE"},a.axisChange(),a.showPlaceholder=!1},function(c){a.showPlaceholder=!1,a.showError=!0,b.log("data loading failed. reason: "+c)}),a.axisChange=function(){if(a.attrForX.value&&a.attrForY.value){var b=f.stockTonvd3Scatter(h,a.attrForX.value,a.attrForY.value);a.data=b}},a.getShape=function(){return function(a){return a.shape}},a.xAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForX.value?b:c;return d},a.yAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForY.value?b:c;return d}}]).controller("stockDTCtrl",["$scope","$log","_","dataLoader","dataStore","dataTransformer","$q",function(a,b,c,d,e,f,g){a.showPlaceholder=!0,a.showError=!1;var h={};g.all([d.get({data:"input.json"}).$promise,d.get({data:"PAL.V_DTP_STOCK_NEW_1D.json"}).$promise]).then(function(b){h.input=b[0],h.predicted=b[1],a.columns=f.getNumericColomns(h.input.columns,h.input.values),a.attrOptions=[],c.each(a.columns,function(b){a.attrOptions.push({attrName:b,value:b})}),a.attrOptions.push({attrName:"DATE",value:"DATE"}),a.attrForX={attrName:"DATE",value:"DATE"},a.attrForY={attrName:"STOCK_CLOSE_PRICE",value:"STOCK_CLOSE_PRICE"},a.axisChange(),a.showPlaceholder=!1},function(c){a.showPlaceholder=!1,a.showError=!0,b.log("data loading failed. reason: "+c)}),a.axisChange=function(){a.attrForX.value&&a.attrForY.value&&(a.data=f.DTToStockPredition(h,a.attrForX.value,a.attrForY.value))},a.getShape=function(){return function(a){return a.shape}},a.xAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForX.value?b:c;return d},a.yAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForY.value?b:c;return d}}]).controller("stockRGCtrl",["$scope","$log","_","dataLoader","dataStore","dataTransformer","$q",function(a,b,c,d,e,f,g){a.showPlaceholder=!0,a.showError=!1;var h={};g.all([d.get({data:"PAL.LGRG_STOCK_CAUSE.json"}).$promise,d.get({data:"PAL.V_LGRGP_STOCK_1D.json"}).$promise]).then(function(b){h.input=b[0],h.predicted=b[1],a.columns=f.getNumericColomns(h.input.columns,h.input.values),a.attrOptions=[],c.each(a.columns,function(b){a.attrOptions.push({attrName:b,value:b})}),a.attrOptions.push({attrName:"DATE",value:"DATE"}),a.attrForX={attrName:"DATE",value:"DATE"},a.attrForY={attrName:"STOCK_CLOSE_PRICE",value:"STOCK_CLOSE_PRICE"},a.axisChange(),a.showPlaceholder=!1},function(c){a.showPlaceholder=!1,a.showError=!0,b.log("data loading failed. reason: "+c)}),a.axisChange=function(){if(a.attrForX.value&&a.attrForY.value){var b=f.RGToStockPredition(h);a.data=b}},a.getShape=function(){return function(a){return a.shape}},a.xAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForX.value?b:c;return d},a.yAxistickformatFunction=function(){var b=function(a){return d3.time.format("%m/%d/%Y")(new Date(a))},c=d3.format(".1f"),d="DATE"===a.attrForY.value?b:c;return d}}]).controller("gridCtrl",["_","$scope","$log","dataLoader","dataStore","dataTransformer",function(a,b,c,d,e,f){b.showPlaceholder=!0,b.showError=!1,b.gridData=[],b.columnDefs=[],b.gridOptions={data:"gridData",enableColumnResize:!0,columnDefs:"columnDefs"};var g=[];d.get({data:"testdata.json"},function(c){b.columns=c.input.columns,a.each(b.columns,function(a){var b={field:a};g.push(b)}),g.push({field:"$group",displayName:"Group"}),b.columnDefs=g,b.gridData=f.LRToGrid(c),b.showPlaceholder=!1},function(a){b.showPlaceholder=!1,b.showError=!0,c.log("data loading failed. reason: "+a)})}]).controller("stockGridCtrl",["_","$scope","$log","dataLoader","dataStore","dataTransformer",function(a,b,c,d,e,f){b.showPlaceholder=!0,b.showError=!1,b.gridData=[],b.columnDefs=[],b.gridOptions={data:"gridData",enableColumnResize:!0,headerRowHeight:60,columnDefs:"columnDefs"};var g=[];d.get({data:"input.json"},function(c){b.columns=c.columns;var d=[50,73,61,66,63,84,84,72,70,74,75,78,76,81,55];a.each(b.columns,function(a,b){var c={field:a,width:d[b]};g.push(c)}),b.columnDefs=g,b.gridData=f.DTToStockGrid(c),b.showPlaceholder=!1},function(a){b.showPlaceholder=!1,b.showError=!0,c.log("data loading failed. reason: "+a)})}]),angular.module("visDirectives",[]).directive("visScatter",function(){return{restrict:"EA",templateUrl:"/views/vis-scatter-template.html",scope:!0}}).directive("visStockDT",function(){return{restrict:"EA",templateUrl:"/views/vis-stock-dt-template.html",scope:!0}}).directive("visStockRG",function(){return{restrict:"EA",templateUrl:"/views/vis-stock-rg-template.html",scope:!0}}).directive("visGrid",function(){return{restrict:"EA",templateUrl:"/views/vis-grid-template.html",scope:!0}}).directive("shapeLegend",["$log",function(){return{restrict:"E",scope:{},template:'<div class="shape-legend-container"></div>',link:function(a){a.legendData=[{x:10,y:5,shape:"triangle-up",text:"Price goes up"},{x:160,y:5,shape:"triangle-down",text:"Price goes down"},{x:310,y:5,shape:"square",text:"Price remains unchanged"}],a.legend=d3.selectAll(".shape-legend-container").append("svg").attr("width",500).attr("height",40),a.legend.selectAll("path").data(a.legendData).enter().append("path").style("stroke","#333").style("fill","#FFF").attr("transform",function(a){return"translate("+a.x+","+a.y+")"}).attr("d",d3.svg.symbol().type(function(a){return a.shape})),a.legend.selectAll("text").data(a.legendData).enter().append("text").attr("transform",function(a){return"translate("+(a.x+20)+","+(a.y+5)+")"}).text(function(a){return a.text})}}}]),angular.module("webApp",["ngCookies","ngResource","ngSanitize","ngRoute","underscore","dataManager","controllers","visDirectives","nvd3ChartDirectives","ngDropdowns","ui.bootstrap","ngGrid"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"/views/tabs.html"}).otherwise({redirectTo:"/"})}]);